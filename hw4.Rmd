---
title: "Dennys_LQ"
author: "Dewen Xu, Muyao Sun, Liwen Zhang, Xialingzi Jin"
date: "10/12/2016"
output: html_document
---

###Task 1 – Scraping La Quinta

get_lq

In order to get each La Quinta’s information, our first step was to obtain and download every La Quinta hotel’s HTML data. Specifically, we used the tool “SelectorGadget” and R package rvest to select each La Quinta’s webpage link from La Quinta's hotel listings page, which was relative address. Then, we created a directory, and used the absolute address to download each La Quinta hotel’s HTML file. We noticed duplication in La Quinta's hotel listings page, therefore function unique( ) was applied to avoid duplicated records.

parse_lq

First, we retrieve full paths of all files in `lq` folder and save them to `files`, and create an empty list called `res`. From the get_lq, we know there are 902 websites of hotel stored in `lq` folder. Then, we use a for loop to iterate over each of hotel website, and in each iteration collect 10 features of the hotel: `location_name` saving the name of each hotel, `address` saving the address of each hotel, `phone` saving the telephone number of each hotel, `fax` saving the fax number of each hotel, `n_rooms` saving the number of rooms of each hotel, `swimming_pool` showing whether does hotel have swimming pools, `internet` showing whether does hotel provide internet connection, `floors` saving the number of floors of each hotel,  `lat` saving the latitude of each hotel and `long` saving the longitude of each hotel. All these 10 features are saved into empty list `res` during each iteration, and at the end of each iteration, we define `res` as a dataframe which contains 10 columns and each column corresponds to one feature of hotel. Since we only need to colloct la quinta hotels in the U.S, we write two tests to remove la quinta hotels in other countries. First, we use the regular expression for US and Cananian telephone number to remove la qunita hotels which are not in these two countries. Second, we use the regular expression for US zipcode to remove la qunita hotels in Canada. Next, we bind all of the dataframes `res` which contain information about each la quinta hotel by row. Finally, we save the dataframe for la quinta hotels as `lq.Rdata` in `data` folder

###Task2 – Scraping Denny’s

get_dennys

As mentioned, the Denny’s site uses 3rd party service to display its locations. After identifying some specific parts (limit,zip_code,radius) of its API, noticing that up to 1000 Denny’s could be found at a time, and googling the total number of Denny’s, we chose LA (zip code: 90210), Hawaii(zip code: 96701), Utah (zip code: 84101) and Washington (zip code: 20001) as anchorages/centers, set radius equal to 5000 miles to cover all Denny’s in US, and recorded their URLs. Then, we created a directory, and used the above URLs (absolute address) to download our four centers’ XML files, which covered all the location information of each Denny’s.

parse_dennys

First, we retrieve our datafile called `de.files` from the data folder that get_dennys saved four xml files and create a empty list called `dennys`. In each of this file, we have 1000 Dennys around the center location within 5000 miles. Second, we would iterate over each of the data file. In each iteration, we would record location name, address, zip code, city, state, country, latitude, longitude and phone number for all of 1000 restaurant Third, we would create a temporary list called `res`, making each restaurant's information as a dataframe stored in `res`. Then we would union `dennys` and `res` to retrieve the unique information about Denny's. Fourth, after complete all iterations, we would bind all of the dataframes which contain information about each Denny's restaurant by rows. Finally, we would filter out the dennys only in the US called `dennys.US`, which will be used for our task 3 analysis. 


###Task3 – Distance Analysis


```{r}
library(fields)

load("data/dennys.Rdata")
load("data/lq.Rdata")

count = 0
for(i in seq_along(hotels[[1]])){
  dist = rdist.earth.vec(matrix(c(as.numeric(dennys.US$long),
                                  as.numeric(dennys.US$lat)),ncol=2),
                         matrix(c(as.numeric(hotels$long)[i],
                                  as.numeric(hotels$lat)[i]),ncol=2),
                         R=3959)
  if(min(dist) < 1){
    count = count +1
  }
}
count
rate = count/length(hotels[[1]])
rate
```


```{r}
count = 0
for(i in seq_along(hotels[[1]]))
  {
  rad <- pi/180
  a1 <- as.numeric(dennys.US$lat) * rad
  a2 <- as.numeric(dennys.US$long) * rad
  b1 <- as.numeric(hotels$lat)[i] * rad
  b2 <- as.numeric(hotels$long)[i] * rad
  d_long <- b2 - a2
  d_lat <- b1 - a1
  a <- (sin(d_lat/2))^2 + cos(a1) * cos(b1) * (sin(d_long/2))^2
  c <- 2 * atan2(sqrt(a), sqrt(1 - a))
  R <- 3959
  d <- R * c
  if(min(d) < 1){
    count = count +1
  }
}
count
rate = count/length(hotels[[1]])
rate
```

